<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.18">
<meta name="description" content="The Official Polkadot and Kusama Protocol Specification">
<meta name="keywords" content="babe, blockchain, consensus, finality, grandpa, kusama, parachain, polkadot, relay-chain, runtime, spec, web3, w3f">
<meta name="author" content="Web 3.0 Technologies Foundation">
<link rel="icon" type="image/png" href="./favicon.png">
<title>Polkadot Protocol Specification</title>
<style>
/* Fetch Unbounded - Normal - Regular */
@import url('https://fonts.googleapis.com/css2?family=Unbounded:wght@400&display=swap');
/* Fetch Work Sans - Normal + Italic - Regular + Bold */
@import url('https://fonts.googleapis.com/css2?family=Work+Sans:ital,wght@0,400;0,700;1,400;1,700&display=swap');
/* Fetch Asciidoctor Default Style Sheet */
@import url('https://cdn.jsdelivr.net/gh/asciidoctor/asciidoctor@2.0/data/stylesheets/asciidoctor-default.css');

/* Base constants of theme */
:root {
	--font-header: 'Unbounded', cursive;
	--font-text: 'Work Sans', sans-serif;

	--black: #1E1E1E;
	--white: #FFFFFF;

	--dark-blue: #172026;
	--grey: #efefef;

	--pink: #E6007A;
	--purple: #670d35;
}


/* Apply some layout corrections */
html {
	height: 100%;
}

body {
	min-height: 100%;
  	display: flex;
  	flex-direction: column;
}

.partintro {
	margin-bottom: 1.25rem;
}

/* Render part intros just like other text */
.partintro div.content {
	line-height: 1.6;
	font-size: 1.0625rem;
	letter-spacing: -.01em;
	text-rendering: optimizeLegibility;
}

/* Set our custom font */
body {
	font-family: var(--font-text);
}

h1, h2, h3, h4, h5, h6,
#toctitle,
#toc ul.sectlevel0 > li > a,
.sidebarblock > .content > .title {
	font-family: var(--font-header);
	font-weight: 400;
}

#toc ul{
	font-family: var(--font-text);
}

/* Set base colors */
body {
	color: var(--black);
	background-color: var(--white);
}

/* Style all titles */
h1, h2, h3, h4, h5, h6,
#toctitle,
.subheader,
.title {
	color: var(--pink);
}

/* - could be replaced by !important in previous block */
.sidebarblock > .content > .title,
.admonitionblock td.content > .title,
.audioblock > .title,
.exampleblock > .title,
.imageblock > .title,
.listingblock > .title,
.literalblock > .title,
.stemblock > .title,
.openblock > .title,
.paragraph > .title,
.quoteblock > .title,
table.tableblock > .title,
.verseblock > .title,
.videoblock > .title,
.dlist > .title,
.olist > .title,
.ulist > .title,
.qlist > .title,
.hdlist > .title {
	color: inherit;
}

h1 code,
h2 code,
h3 code,
h4 code,
h5 code,
h6 code {
    color: inherit;
}

/* Style all links */
a {
	color: var(--pink);
}

a:hover {
	color: var(--purple);
}

/* - same here, next two blocks or important above */
#content h1 > a.link,
h2 > a.link,
h3 > a.link, #toctitle > a.link,
h4 > a.link,
h5 > a.link,
h6 > a.link,
.sidebarblock > .content > .title > a.link {
	color: inherit;
}

#content h1 > a.link:hover,
h2 > a.link:hover,
h3 > a.link:hover,
h4 > a.link:hover,
h5 > a.link:hover,
h6 > a.link:hover,
#toctitle > a.link:hover,
.sidebarblock > .content > .title > a.link:hover {
	color: var(--purple);
}

/* Style header like toc on small screens */
@media screen and (max-width:768px) {
	#header {
		background-color: var(--dark-blue);
		max-width: none;
	}

	#header > h1:first-child {
  		color: var(--pink);
	}

	#header .details {
  		color: var(--white);
		border: none;
	}
}

/* Style table of content */
#toc.toc2 {
	background-color: var(--dark-blue);
	border: none;
}

#toc ul.sectlevel0 > li > a {
  font-weight: bold;
  font-style: normal;
  text-decoration: underline;
}

#toc a {
	color: var(--white);
}

#toc a code {
	color: inherit;
	background-color: inherit;
}

#toc a .toc-current,
#toc .tocify-focus a {
	color: var(--pink);
}

/* Tame SVG images */
.imageblock .content svg {
  max-width: 100%;
}

/* Style boxes */
.exampleblock > .content, 
.sidebarblock {
	background: var(--grey);
}

/* Style footer */
#footer {
	color: var(--white);
	background-color: var(--dark-blue);
}

/* CSS Ribbon */
.ribbon {
  position: absolute;
  width: 200px;
  height: 200px;
  overflow: hidden;
  z-index: 99999;
  top: 0px;
  right: 0px;
}

.ribbon a {
  display: inline-block;
  position: inherit;
  transform: rotate(45deg);
  width: 200px;
  top: 45px; 
  right: -40px;
  padding: 6px 0px;
  overflow: hidden;

  text-align: center;
  font-size: 12px;
  font-weight: bold;
  text-decoration: none;

  color: var(--white);
  background-color: var(--pink);
  background-image: linear-gradient(rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.15));
  border: 2px dotted var(--white);
  box-shadow: rgba(0, 0, 0, 0.5) 0px 2px 3px 0px;
}

/* MathJax v3 */
.stemblock mjx-container {
  text-align: center;
  display: block;
  width: 100%;
  margin: 1em 0em;
}

/* Pseudocode.js */
.ps-root {
  font-size: 1.2em !important;
}

/* Fix inline svg with fixed width or height. */
.imageblock .content svg {
  widht: auto;
  height: auto;
}

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>.toc-current{font-weight: bold;} .toc-root{font-family: "Open Sans","DejaVu Sans",sans-serif;
                       font-size: 0.9em;} #content{display: flex; flex-direction: column; flex: 1 1 auto;}
             .nav-footer{text-align: center; margin-top: auto;}
             .nav-footer > p > a {white-space: nowrap;}</style>
</head>
<body id="id-cryptography-encoding" class="book toc2 toc-left">
<!-- Contribution Ribbon -->
<div class="ribbon"><a target="_blank" href="https://github.com/w3f/polkadot-spec">Contributions welcome!</a></div>
<div id="header">
<h1>Polkadot Protocol Specification</h1>
<div class="details">
<span id="author" class="author">Web 3.0 Technologies Foundation</span><br>
<span id="revnumber">version 0.2.1</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<p><span class="toc-root"><a href="polkadot-spec.html">Polkadot Protocol Specification</a></span></p><ul class="sectlevel1">
<li><a href="id-polkadot-protocol.html">Polkadot Protocol</a>
</li>
<li><a href="part-polkadot-host.html">Polkadot Host</a>
</li>
<li><a href="part-polkadot-runtime.html">Polkadot Runtime</a>
</li>
<li><a href="id-cryptography-encoding.html"><span class="toc-current">Appendix D: Cryptography &amp; Encoding</span></a>
<ul class="sectlevel2">
<li><a href="id-cryptography-encoding.html#chapter-crypto-algos">A.1. Cryptographic Algorithms</a>
</li>
<li><a href="id-cryptography-encoding.html#chapter-encoding">A.2. Auxiliary Encodings</a>
</li>
<li><a href="id-cryptography-encoding.html#chapter-genesis">A.3. Genesis State</a>
</li>
<li><a href="id-cryptography-encoding.html#chapter-erasure-encoding">A.4. Erasure Encoding</a>
</li>
</ul>
</li>
<li><a href="chap-host-api.html">Appendix E: Host API</a>
</li>
<li><a href="chap-runtime-api.html">Appendix F: Runtime API</a>
</li>
<li><a href="id-bibliography.html">Bibliography</a>
</li>
<li><a href="id-glossary.html">Glossary</a>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="id-cryptography-encoding"><a class="anchor" href="#id-cryptography-encoding"></a><a class="link" href="#id-cryptography-encoding">Appendix A: Cryptography &amp; Encoding</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Appendix chapter containing various protocol details</p>
</div>
<div class="sect2">
<h3 id="chapter-crypto-algos"><a class="anchor" href="#chapter-crypto-algos"></a><a class="link" href="#chapter-crypto-algos">A.1. Cryptographic Algorithms</a></h3>
<div class="sect3">
<h4 id="sect-hash-functions"><a class="anchor" href="#sect-hash-functions"></a><a class="link" href="#sect-hash-functions">A.1.1. Hash Functions</a></h4>
<div class="sect4">
<h5 id="sect-blake2"><a class="anchor" href="#sect-blake2"></a><a class="link" href="#sect-blake2">A.1.1.1. BLAKE2</a></h5>
<div class="paragraph">
<p>BLAKE2 is a collection of cryptographic hash functions known for their high
speed. Their design closely resembles BLAKE which has been a finalist in the
SHA-3 competition.</p>
</div>
<div class="paragraph">
<p>Polkadot is using the Blake2b variant which is optimized for 64-bit platforms.
Unless otherwise specified, the Blake2b hash function with a 256-bit output is
used whenever Blake2b is invoked in this document. The detailed specification
and sample implementations of all variants of Blake2 hash functions can be found
in RFC 7693 cite:[saarinen_blake2_2015].</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sect-randomness"><a class="anchor" href="#sect-randomness"></a><a class="link" href="#sect-randomness">A.1.2. Randomness</a></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TBH
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="sect-vrf"><a class="anchor" href="#sect-vrf"></a><a class="link" href="#sect-vrf">A.1.3. VRF</a></h4>
<div class="paragraph">
<p>A Verifiable Random Function (VRF) is a mathematical operation that takes some
input and produces a random number using a secret key along with a proof of
authenticity that this random number was generated using the submitter&#8217;s secret
key and the given input. The proof can be verified by any challenger to ensure
the random number generation is valid and has not been tampered with (for
example to the benfit of submitter).</p>
</div>
<div class="paragraph">
<p>In Polkadot, VRFs are used for the BABE block production lottery by
<a href="sect-block-production.html#algo-block-production-lottery">Block-Production-Lottery</a>  and the parachain approval voting mechanism
(<a href="chapter-anv.html#sect-approval-voting">Section 8.5</a>). The VRF uses mechanism similar to algorithms introduced
in the following papers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://eprint.iacr.org/2017/099.pdf">Making NSEC5 Practical for DNSSEC</a> cite:[papadopoulos17]</p>
</li>
<li>
<p><a href="https://blog.cloudflare.com/privacy-pass-the-math/#dleqproofs">DLEQ Proofs</a></p>
</li>
<li>
<p><a href="https://tools.ietf.org/id/draft-goldbe-vrf-01.html">Verifiable Random Functions (VRFs)</a> cite:[goldberg17]</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It essentially generates a deterministic elliptic curve based Schnorr
signature as a verifiable random value. The elliptic curve group used in the VRF
function is the Ristretto group specified in:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://ristretto.group/" class="bare">ristretto.group/</a></p>
</li>
</ul>
</div>
<div id="defn-vrf-proof" class="exampleblock">
<div class="title">Definition 171. <a href="id-cryptography-encoding.html#defn-vrf-proof">VRF Proof</a></div>
<div class="content">
<div class="paragraph">
<p>The <strong>VRF proof</strong> proves the correctness for an associated VRF output. The VRF
proof, \$P\$, is a datastructure of the following format:</p>
</div>
<div class="stemblock">
<div class="content">
\$P = (C,S)\$
\$S = (b_0, ... b_31)\$
</div>
</div>
<div class="paragraph">
<p>where \$C\$ is the challenge and \$S\$ is the 32-byte Schnorr poof. Both
are expressed as Curve25519 scalars as defined in Definition
<a href="id-cryptography-encoding.html#defn-vrf-dleq-prove">Definition 172</a>.</p>
</div>
</div>
</div>
<div id="defn-vrf-dleq-prove" class="exampleblock">
<div class="title">Definition 172. <a href="id-cryptography-encoding.html#defn-vrf-dleq-prove"><code>DLEQ Prove</code></a></div>
<div class="content">
<div class="paragraph">
<p>The \$"dleq_prove"(t, i)\$ function creates a proof for a given input, \$i\$,
based on the provided transcript, \$T\$.</p>
</div>
<div class="paragraph">
<p>First:</p>
</div>
<div class="stemblock">
<div class="content">
\$t_1 = "append"(t, "'proto-name'", "'DLEQProof'")\$
\$t_2 = "append"(t_1, "'vrf:h'", i)\$
</div>
</div>
<div class="paragraph">
<p>Then the witness scalar is calculated, \$s_w\$, where \$w\$ is the
32-byte secret seed used for nonce generation in the context of sr25519.</p>
</div>
<div class="stemblock">
<div class="content">
\$t_3 = "meta-AD"(t_2, "'proving\\00'", "more=False")\$
\$t_4 = "meta-AD"(t_3, w_l, "more=True")\$
\$t_5 = "KEY"(t_4, w, "more=False")\$
\$t_6 = "meta-AD"(t_5, "'rng'", "more=False")\$
\$t_7 = "KEY"(t_6, r, "more=False")\$
\$t_8 = "meta-AD"(t_7, e_(64), "more=False")\$
\$(phi, s_w) = "PRF"(t_8, "more=False")\$
</div>
</div>
<div class="paragraph">
<p>where \$w_l\$ is length of the witness, encoded as a 32-bit little-endian
integer. \$r\$ is a 32-byte array containing the secret witness scalar.</p>
</div>
<div class="stemblock">
<div class="content">
\$l_1 = "append"(t_2, "'vrf:R=g^r'", s_w)\$
\$l_2 = "append"(l_1, "'vrf:h^r'", s_i)\$
\$l_3 = "append"(l_2, "'vrf:pk'", s_p)\$
\$l_4 = "append"(l_3, "'vrf:h^sk'", "vrf"_o)\$
</div>
</div>
<div class="paragraph">
<p>where</p>
</div>
<div class="ulist">
<ul>
<li>
<p>\$s_i\$ is the compressed Ristretto point of the scalar input.</p>
</li>
<li>
<p>\$s_p\$ is the compressed Ristretto point of the public key.</p>
</li>
<li>
<p>\$s_w\$ is the compressed Ristretto point of the wittness:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For the 64-byte challenge:</p>
</div>
<div class="stemblock">
<div class="content">
\$l_5 = "meta-AD"(l_4, "'prove'", "more=False")\$
\$l_6 = "meta-AD"(l_5, e_(64), "more=True")\$
\$C = "PRF"(l_6, "more=False")\$
</div>
</div>
<div class="paragraph">
<p>And the Schnorr proof:</p>
</div>
<div class="stemblock">
<div class="content">
\$S = s_w - (C * p)\$
</div>
</div>
<div class="paragraph">
<p>where \$p\$ is the secret key.</p>
</div>
</div>
</div>
<div id="defn-vrf-dleq-verify" class="exampleblock">
<div class="title">Definition 173. <a href="id-cryptography-encoding.html#defn-vrf-dleq-verify"><code>DLEQ Verify</code></a></div>
<div class="content">
<div class="paragraph">
<p>The \$"dleq_verify"(i, o, P, p_k)\$ function verifiers the VRF input,
\$i\$ against the output, \$o\$, with the associated proof
(<a href="id-cryptography-encoding.html#defn-vrf-proof">Definition 171</a>) and public key, \$p_k\$.</p>
</div>
<div class="stemblock">
<div class="content">
\$t_1 = "append"(t, "'proto-name'", "'DLEQProof'")\$
\$t_2 = "append"(t_1, "'vrf:h'", s_i)\$
\$t_3 = "append"(t_2, "'vrf:R=g^r'", R)\$
\$t_4 = "append"(t_3, "'vrf:h^r'", H)\$
\$t_5 = "append"(t_4, "'vrf:pk'", p_k)\$
\$t_6 = "append"(t_5, "'vrf:h^sk'", o)\$
</div>
</div>
<div class="paragraph">
<p>where</p>
</div>
<div class="ulist">
<ul>
<li>
<p>\$R\$ is calculated as:</p>
<div class="stemblock">
<div class="content">
\$R = C in P xx p_k + S in P + B\$
</div>
</div>
<div class="paragraph">
<p>where \$B\$ is the Ristretto basepoint.</p>
</div>
</li>
<li>
<p>\$H\$ is calculated as:</p>
<div class="stemblock">
<div class="content">
\$H = C in P xx o + S in P xx i\$
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The challenge is valid if \$C in P\$ equals \$y\$:</p>
</div>
<div class="stemblock">
<div class="content">
\$t_7 = "meta-AD"(t_6, "'prove'", "more=False")\$
\$t_8 = "meta-AD"(t_7, e_(64), "more=True")\$
\$y = "PRF"(t_8, "more=False")\$
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="id-transcript"><a class="anchor" href="#id-transcript"></a><a class="link" href="#id-transcript">A.1.3.1. Transcript</a></h5>
<div class="paragraph">
<p>A VRF transcript serves as a domain-specific separator of cryptographic
protocols and is represented as a mathematical object, as defined by Merlin,
which defines how that object is generated and encoded. The usage of the
transcript is implementation specific, such as for certain mechanisms in the
Availability &amp; Validity chapter (<a href="chapter-anv.html">Chapter 8</a>), and is therefore described in
more detail in those protocols. The input value used to initiate the
transcript is referred to as a <em>context</em> (<a href="id-cryptography-encoding.html#defn-vrf-context">Definition 174</a>).</p>
</div>
<div id="defn-vrf-context" class="exampleblock">
<div class="title">Definition 174. <a href="id-cryptography-encoding.html#defn-vrf-context">VRF Contex</a></div>
<div class="content">
<div class="paragraph">
<p>The <strong>VRF context</strong> is a constant byte array used to initiate VRF transcript. The VRF context is constant for all users of the VRF for the specific context for which the VRF function is used. Context prevents VRF values generated by the same nodes for other purposes to be reused for purposes not meant to. For example, the VRF context for BABE Production lottery defined in <a href="sect-block-production.html#sect-block-production-lottery">Section 5.2</a> is set to be "substrate-babe-vrf".</p>
</div>
</div>
</div>
<div id="defn-vrf-transcript" class="exampleblock">
<div class="title">Definition 175. <a href="id-cryptography-encoding.html#defn-vrf-transcript">VRF Transcript</a></div>
<div class="content">
<div class="paragraph">
<p>A <strong>transcript</strong>, or VRF transcript, is a STROBE object, \$"obj"\$, as defined
in the STROBE documentation, respectively section
<a href="https://strobe.sourceforge.io/specs/#object">"5. State of a STROBE object"</a>.</p>
</div>
<div class="stemblock">
<div class="content">
\$"obj" = ("st","pos","pos"_("begin"),I_0)\$
</div>
</div>
<div class="paragraph">
<p>where:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The duplex state, \$"st"\$, is a 200-byte array created by the
<a href="https://keccak.team/keccak_specs_summary.html">keccak-f1600 sponge function</a> on
the <a href="https://strobe.sourceforge.io/specs/#object.initial">initial STROBE state</a>.
Specifically, <code>R</code> is of value <code>166</code> and <code>X.Y.Z</code> is of value <code>1.0.2</code>.</p>
</li>
<li>
<p>\$"pos"\$ has the initial value of <code>0</code>.</p>
</li>
<li>
<p>\$"pos"_("begin")\$ has the initial value of <code>0</code>.</p>
</li>
<li>
<p>\$I_0\$ has the initial value of <code>0</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Then, the <code>meta-AD</code> operation (<a href="id-cryptography-encoding.html#defn-strobe-operations">Definition 176</a>) (where <code>more=False</code>) is
used to add the protocol label <code>Merlin v1.0</code> to \$"obj"\$ followed by
<em>appending</em> (<a href="id-cryptography-encoding.html#sect-vrf-appending-messages">Section A.1.3.1.1</a>) label <code>dom-step</code> and its
corresponding context, \$ctx\$, resulting in the final transcript, \$T\$.</p>
</div>
<div class="stemblock">
<div class="content">
\$t = "meta-AD"(obj, "'Merlin v1.0'", "False")\$
\$T = "append"(t, "'dom-step'", "ctx")\$
</div>
</div>
<div class="paragraph">
<p>\$"ctx"\$ serves as an arbitrary identifier/separator and its value is
defined by the protocol specification individually. This transcript is treated
just like a STROBE object, wherein any operations (<a href="id-cryptography-encoding.html#defn-strobe-operations">Definition 176</a>)
on it modify the values such as \$"pos"\$ and \$"pos"_("begin")\$.</p>
</div>
<div class="paragraph">
<p>Formally, when creating a transcript we refer to it as \$"Transcript"(ctx)\$.</p>
</div>
</div>
</div>
<div id="defn-strobe-operations" class="exampleblock">
<div class="title">Definition 176. <a href="id-cryptography-encoding.html#defn-strobe-operations">STROBE Operations</a></div>
<div class="content">
<div class="paragraph">
<p>STROBE operations are described in the
<a href="https://strobe.sourceforge.io/specs/">STROBE specification</a>, respectively section
<a href="https://strobe.sourceforge.io/specs/#ops">"6. Strobe operations"</a>. Operations are
indicated by their corresponding bitfield, as described in section
<a href="https://strobe.sourceforge.io/specs/#ops.flags">"6.2. Operations and flags"</a> and
implemented as described in section
<a href="https://strobe.sourceforge.io/specs/#ops.impl">"7. Implementation of operations"</a></p>
</div>
</div>
</div>
<div class="sect5">
<h6 id="sect-vrf-appending-messages"><a class="anchor" href="#sect-vrf-appending-messages"></a><a class="link" href="#sect-vrf-appending-messages">Appending Messages</a></h6>
<div class="paragraph">
<p>Appending messages, or "data", to the transcript (<a href="id-cryptography-encoding.html#defn-vrf-transcript">Definition 175</a>) first
requires <code>meta-AD</code> operations for a given label of the messages, including the
size of the message, followed by an <code>AD</code> operation on the message itself. The
size of the message is a 4-byte, little-endian encoded integer.</p>
</div>
<div class="stemblock">
<div class="content">
\$T_0 = "meta-AD"(T, l, "False")\$
\$T_1 = "meta-AD"(T_0, m_l, "True")\$
\$T_2 = "AD"(T_1, m, "False")\$
</div>
</div>
<div class="paragraph">
<p>where \$T\$ is the transcript (<a href="id-cryptography-encoding.html#defn-vrf-transcript">Definition 175</a>), \$l\$ is the
given label and \$m\$ the message, respectively \$m_l\$ representing its
size. \$T_2\$ is the resulting transcript with the appended data. STROBE
operations are described in <a href="id-cryptography-encoding.html#defn-strobe-operations">Definition 176</a>.</p>
</div>
<div class="paragraph">
<p>Formally, when appending a message we refer to it as \$"append"(T, l, m)\$.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sect-cryptographic-keys"><a class="anchor" href="#sect-cryptographic-keys"></a><a class="link" href="#sect-cryptographic-keys">A.1.4. Cryptographic Keys</a></h4>
<div class="paragraph">
<p>Various types of keys are used in Polkadot to prove the identity of the actors
involved in the Polkadot Protocols. To improve the security of the users, each
key type has its own unique function and must be treated differently, as
described by this Section.</p>
</div>
<div id="defn-account-key" class="exampleblock">
<div class="title">Definition 177. <a href="id-cryptography-encoding.html#defn-account-key">Account Key</a></div>
<div class="content">
<div class="paragraph">
<p><strong>Account key \$(sk^a,pk^a)\$</strong> is a key pair of type of either of the schemes in the following
table:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. List of the public key scheme which can be used for an account key</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Key Scheme</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sr25519</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Schnorr signature on Ristretto compressed ed25519 points as implemented in TODO</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ed25519</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ed25519 signature complies with cite:[josefsson_edwards-curve_2017] except for the verification process which adhere to Ed25519 Zebra variant specified in cite:[devalence_ed25519zebra_2020]. In short, the signature point is not assumed to be on in the prime ordered subgroup group. As such, the verifier must explicitly clear the cofactor during the course of verifying the signature equation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">secp256k1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only for outgoing transfer transactions.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>An account key can be used to sign transactions among other accounts and
balance-related functions. There are two prominent subcategories of account keys
namely "stash keys" and "controller keys", each being used for a different
function. Keys defined in <a href="id-cryptography-encoding.html#defn-account-key">Definition 177</a>, <a href="id-cryptography-encoding.html#defn-stash-key">Definition 178</a>
and <a href="id-cryptography-encoding.html#defn-controller-key">Definition 179</a> are created and managed by the user independent of
the Polkadot implementation. The user notifies the network about the used keys
by submitting a transaction, as defined in
<a href="id-cryptography-encoding.html#sect-creating-controller-key">Section A.1.4.2</a> and <a href="id-cryptography-encoding.html#sect-certifying-keys">Section A.1.4.5</a>
respectively.</p>
</div>
</div>
</div>
<div id="defn-stash-key" class="exampleblock">
<div class="title">Definition 178. <a href="id-cryptography-encoding.html#defn-stash-key">Stash Key</a></div>
<div class="content">
<div class="paragraph">
<p>The <strong>Stash key</strong> is a type of account key that holds funds bonded for staking
(described in <a href="id-cryptography-encoding.html#sect-staking-funds">Section A.1.4.1</a>) to a particular
controller key (defined in <a href="id-cryptography-encoding.html#defn-controller-key">Definition 179</a>). As a result, one may actively
participate with a stash key keeping the stash key offline in a secure location.
It can also be used to designate a Proxy account to vote in governance
proposals, as described in <a href="id-cryptography-encoding.html#sect-creating-controller-key">Section A.1.4.2</a>. The Stash
key holds the majority of the users’ funds and should neither be shared with
anyone, saved on an online device, nor used to submit extrinsics.</p>
</div>
</div>
</div>
<div id="defn-controller-key" class="exampleblock">
<div class="title">Definition 179. <a href="id-cryptography-encoding.html#defn-controller-key">Controller Key</a></div>
<div class="content">
<div class="paragraph">
<p>The <strong>Controller key</strong> is a type of account key that acts on behalf of the Stash
account. It signs transactions that make decisions regarding the nomination and
the validation of the other keys. It is a key that will be in direct control of
a user and should mostly be kept offline, used to submit manual extrinsics. It
sets preferences like payout account and commission, as described in
<a href="id-cryptography-encoding.html#sect-controller-settings">Section A.1.4.4</a>. If used for a validator, it certifies the
session keys, as described in <a href="id-cryptography-encoding.html#sect-certifying-keys">Section A.1.4.5</a>. It only needs
the required funds to pay transaction fees [TODO: key needing fund needs to be
defined].</p>
</div>
</div>
</div>
<div id="defn-session-key" class="exampleblock">
<div class="title">Definition 180. <a href="id-cryptography-encoding.html#defn-session-key">Session Keys</a></div>
<div class="content">
<div class="paragraph">
<p><strong>Session keys</strong> are short-lived keys that are used to authenticate validator
operations. Session keys are generated by the Polkadot Host and should be
changed regularly due to security reasons. Nonetheless, no validity period is
enforced by the Polkadot protocol on session keys. Various types of keys used by
the Polkadot Host are presented in <a href="id-cryptography-encoding.html#tabl-session-keys">Table 3</a>:</p>
</div>
<table id="tabl-session-keys" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. List of key schemes which are used for session keys depending on the protocol</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Protocol</th>
<th class="tableblock halign-left valign-top">Key scheme</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GRANDPA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ED25519</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BABE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SR25519</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">I’m Online</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SR25519</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parachain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SR25519</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Session keys must be accessible by certain Polkadot Host APIs defined in
Appendix <a href="chap-host-api.html">Appendix B</a>. Session keys are <em>not</em> meant to control the
majority of the users’ funds and should only be used for their intended purpose.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sect-staking-funds"><a class="anchor" href="#sect-staking-funds"></a><a class="link" href="#sect-staking-funds">A.1.4.1. Holding and staking funds</a></h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TBH
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="sect-creating-controller-key"><a class="anchor" href="#sect-creating-controller-key"></a><a class="link" href="#sect-creating-controller-key">A.1.4.2. Creating a Controller key</a></h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TBH
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="sect-designating-proxy"><a class="anchor" href="#sect-designating-proxy"></a><a class="link" href="#sect-designating-proxy">A.1.4.3. Designating a proxy for voting</a></h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TBH
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="sect-controller-settings"><a class="anchor" href="#sect-controller-settings"></a><a class="link" href="#sect-controller-settings">A.1.4.4. Controller settings</a></h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
TBH
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="sect-certifying-keys"><a class="anchor" href="#sect-certifying-keys"></a><a class="link" href="#sect-certifying-keys">A.1.4.5. Certifying keys</a></h5>
<div class="paragraph">
<p>Due to security considerations and Runtime upgrades, the session keys are
supposed to  be changed regularly. As such, the new session keys need to be
certified by a controller key before putting them in use. The controller only
needs to create a certificate by signing a session public key and broadcasting
this certificate via an extrinsic. [TODO: spec the detail of the data structure
of the certificate etc.]</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="chapter-encoding"><a class="anchor" href="#chapter-encoding"></a><a class="link" href="#chapter-encoding">A.2. Auxiliary Encodings</a></h3>
<div id="defn-unix-time" class="exampleblock">
<div class="title">Definition 181. <a href="id-cryptography-encoding.html#defn-unix-time">Unix Time</a></div>
<div class="content">
<div class="paragraph">
<p>By <strong>Unix time</strong>, we refer to the unsigned, little-endian encoded 64-bit integer
which stores the number of <strong>milliseconds</strong> that have elapsed since the Unix
epoch, that is the time 00:00:00 UTC on 1 January 1970, minus leap seconds. Leap
seconds are ignored, and every day is treated as if it contained exactly 86’400
seconds.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-binary-enconding"><a class="anchor" href="#id-binary-enconding"></a><a class="link" href="#id-binary-enconding">A.2.1. Binary Enconding</a></h4>
<div id="defn-byte-sequence" class="exampleblock">
<div class="title">Definition 182. <a href="id-cryptography-encoding.html#defn-byte-sequence">Sequence of Bytes</a></div>
<div class="content">
<div class="paragraph">
<p>By a <strong>sequences of bytes</strong> or a <strong>byte array</strong>, \$b\$, of length
\$n\$, we refer to</p>
</div>
<div class="stemblock">
<div class="content">
\$b := (b_0, b_1, ..., b_{n - 1}) " such that " 0 &lt;= b_i &lt;= 255\$
</div>
</div>
<div class="paragraph">
<p>We define \$bbb B_n\$ to be the
<strong>set of all byte arrays of length \$n\$</strong>. Furthermore, we
define:</p>
</div>
<div class="stemblock">
<div class="content">
\$bbb B := uuu_(i=0)^infty bbb B_i\$
</div>
</div>
<div class="paragraph">
<p>We represent the concatenation of byte arrays
\$a :=(a_0, ..., a_n)\$ and
\$b :=(b_0, ..., b_m)\$ by:</p>
</div>
<div class="stemblock">
<div class="content">
\$a |\| b :=(a_0, ..., a_n, b_0, ..., b_m)\$
</div>
</div>
</div>
</div>
<div id="defn-bit-rep" class="exampleblock">
<div class="title">Definition 183. <a href="id-cryptography-encoding.html#defn-bit-rep">Bitwise Representation</a></div>
<div class="content">
<div class="paragraph">
<p>For a given byte \$0 &lt;= b &lt;= 255\$ the <strong>bitwise representation</strong> in bits \$b_i in {0, 1}\$ is defined as:</p>
</div>
<div class="stemblock">
<div class="content">
\$b := b_7 ... b_0\$
</div>
</div>
<div class="paragraph">
<p>where</p>
</div>
<div class="stemblock">
<div class="content">
\$b = 2^7 b_7 + 2^6 b_6 + ... + 2^0 b_0\$
</div>
</div>
</div>
</div>
<div id="defn-little-endian" class="exampleblock">
<div class="title">Definition 184. <a href="id-cryptography-encoding.html#defn-little-endian">Little Endian</a></div>
<div class="content">
<div class="paragraph">
<p>By the <strong>little-endian</strong> representation of a non-negative integer, \$I\$,
represented as</p>
</div>
<div class="stemblock">
<div class="content">
\$I = (B_n ... B_0)_256\$
</div>
</div>
<div class="paragraph">
<p>in base 256, we refer to a byte array
\$B = (b_0, b_1, ..., b_n)\$ such that</p>
</div>
<div class="stemblock">
<div class="content">
\$b_i :=B_i\$
</div>
</div>
<div class="paragraph">
<p>Accordingly, we define the function \$sf "Enc"_(sf "LE")\$:</p>
</div>
<div class="stemblock">
<div class="content">
\$sf "Enc"_(sf "LE"): bbb Z^+ -&gt; bbb B; (B_n ... B_0)_256 |-&gt; (B_{0,} B_1, ... , B_n)\$
</div>
</div>
</div>
</div>
<div id="defn-uint32" class="exampleblock">
<div class="title">Definition 185. <a href="id-cryptography-encoding.html#defn-uint32">UINT32</a></div>
<div class="content">
<div class="paragraph">
<p>By <strong>UINT32</strong> we refer to a non-negative integer stored in a byte array of
length \$4\$ using little-endian encoding format.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sect-scale-codec"><a class="anchor" href="#sect-scale-codec"></a><a class="link" href="#sect-scale-codec">A.2.2. SCALE Codec</a></h4>
<div class="paragraph">
<p>The Polkadot Host uses <em>Simple Concatenated Aggregate Little-Endian” (SCALE)
codec</em> to encode byte arrays as well as other data structures. SCALE provides a
canonical encoding to produce consistent hash values across their
implementation, including the Merkle hash proof for the State Storage.</p>
</div>
<div id="defn-scale-decoding" class="exampleblock">
<div class="title">Definition 186. <a href="id-cryptography-encoding.html#defn-scale-decoding">Decoding</a></div>
<div class="content">
<div class="paragraph">
<p>\$"Dec"_("SC")(d)\$ refers to the decoding of a blob of data. Since the SCALE codec is not
self-describing, it’s up to the decoder to validate whether the blob of data can
be deserialized into the given type or data structure.</p>
</div>
<div class="paragraph">
<p>It&#8217;s accepted behavior for the decoder to partially decode the blob of data.
Meaning, any additional data that does not fit into a datastructure can be
ignored.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Considering that the decoded data is never larger than the encoded
message, this information can serve as a way to validate values that can vary in
sizes, such as sequences (<a href="id-cryptography-encoding.html#defn-scale-list">Definition 192</a>). The decoder should strictly use
the size of the encoded data as an upper bound when decoding in order to prevent
denial of service attacks.
</td>
</tr>
</table>
</div>
</div>
</div>
<div id="defn-scale-tuple" class="exampleblock">
<div class="title">Definition 187. <a href="id-cryptography-encoding.html#defn-scale-tuple">Tuple</a></div>
<div class="content">
<div class="paragraph">
<p>The <strong>SCALE codec</strong> for <strong>Tuple</strong>, \$T\$, such that:</p>
</div>
<div class="stemblock">
<div class="content">
\$T := (A_1,... A_n)\$
</div>
</div>
<div class="paragraph">
<p>Where \$A_i\$’s are values of <strong>different types</strong>, is defined as:</p>
</div>
<div class="stemblock">
<div class="content">
\$"Enc"_("SC")(T) := "Enc"_("SC")(A_1) "||" "Enc"_("SC")(A_2) "||" ... "||" "Enc"_("SC")(A_n)\$
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>In case of a tuple (or a structure), the knowledge of the shape of data is not
encoded even though it is necessary for decoding. The decoder needs to derive
that information from the context where the encoding/decoding is happening.</p>
</div>
<div id="defn-varrying-data-type" class="exampleblock">
<div class="title">Definition 188. <a href="id-cryptography-encoding.html#defn-varrying-data-type">Varying Data Type</a></div>
<div class="content">
<div class="paragraph">
<p>We define a <strong>varying data</strong> type to be an ordered set of data types.</p>
</div>
<div class="stemblock">
<div class="content">
\$cc T = {T_1, ..., T_n}\$
</div>
</div>
<div class="paragraph">
<p>A value \$A\$ of varying date type is a pair \$(A_("Type"),A_("Value"))\$
where \$A_("Type") = T_i\$ for some \$T_i in cc T\$ and
\$A_("Value")\$ is its value of type \$T_i\$, which can be empty. We
define \$"idx"(T_i) = i - 1\$, unless it is explicitly defined as another
value in the definition of a particular varying data type.</p>
</div>
<div class="paragraph">
<p>In particular, we define two specific varying data which are frequently used in
various part of Polkadot protocol: <em>Option</em> (<a href="id-cryptography-encoding.html#defn-option-type">Definition 190</a>) and <em>Result</em>
(<a href="id-cryptography-encoding.html#defn-result-type">Definition 191</a>).</p>
</div>
</div>
</div>
<div id="defn-scale-variable-type" class="exampleblock">
<div class="title">Definition 189. <a href="id-cryptography-encoding.html#defn-scale-variable-type">Encoding of Varying Data Type</a></div>
<div class="content">
<div class="paragraph">
<p>The SCALE codec for value \$A = (A_("Type"), A_("Value"))\$ of varying data
type \$cc T = {T_i, ... T_n}\$, formally referred to as
\$"Enc"_("SC")(A)\$ is defined as follows:</p>
</div>
<div class="stemblock">
<div class="content">
\$"Enc"_("SC")(A) := "Enc"_("SC")("idx"(A_("Type")) "||" "Enc"_("SC")(A_("Value")))\$
</div>
</div>
<div class="paragraph">
<p>Where \$"idx"\$ is a 8-bit integer determining the type of \$A\$. In
particular, for the optional type defined in <a href="id-cryptography-encoding.html#defn-varrying-data-type">Definition 188</a>, we
have:</p>
</div>
<div class="stemblock">
<div class="content">
\$"Enc"_("SC")("None", phi) := 0_(bbb B_1)\$
</div>
</div>
<div class="paragraph">
<p>The SCALE codec does not encode the correspondence between the value and the
data type it represents; the decoder needs prior knowledge of such
correspondence to decode the data.</p>
</div>
</div>
</div>
<div id="defn-option-type" class="exampleblock">
<div class="title">Definition 190. <a href="id-cryptography-encoding.html#defn-option-type">Option Type</a></div>
<div class="content">
<div class="paragraph">
<p>The <strong>Option</strong> type is a varying data type of \${"None",T_2}\$ which indicates if
data of \$T_2\$ type is available (referred to as <em>some</em> state) or not
(referred to as <em>empty</em>, <em>none</em> or <em>null</em> state). The presence of type <em>none</em>,
indicated by \$"idx"(T_("None")) = 0\$, implies that the data corresponding
to \$T_2\$ type is not available and contains no additional data. Where as
the presence of type \$T_2\$ indicated by \$"idx"(T_2) = 1\$ implies that
the data is available.</p>
</div>
</div>
</div>
<div id="defn-result-type" class="exampleblock">
<div class="title">Definition 191. <a href="id-cryptography-encoding.html#defn-result-type">Result Type</a></div>
<div class="content">
<div class="paragraph">
<p>The <strong>Result</strong> type is a varying data type of \${T_1, T_2}\$ which is used to
indicate if a certain operation or function was executed successfully (referred
to as "ok" state) or not (referred to as "error" state). \$T_1\$ implies
success, \$T_2\$ implies failure. Both types can either contain additional
data or are defined as empty type otherwise.</p>
</div>
</div>
</div>
<div id="defn-scale-list" class="exampleblock">
<div class="title">Definition 192. <a href="id-cryptography-encoding.html#defn-scale-list">Sequence</a></div>
<div class="content">
<div class="paragraph">
<p>The <strong>SCALE codec</strong> for <strong>sequence</strong> \$S\$ such that:</p>
</div>
<div class="stemblock">
<div class="content">
\$S := A_1, ... A_n\$
</div>
</div>
<div class="paragraph">
<p>where \$A_i\$’s are values of <strong>the same type</strong> (and the decoder is unable to
infer value of \$n\$ from the context) is defined as:</p>
</div>
<div class="stemblock">
<div class="content">
\$"Enc"_("SC")(S) := "Enc"_("SC")^("Len")(abs(S)) "||" "Enc"_("SC")(A_2) "||" ... "||" "Enc"_("SC")(A_n)\$
</div>
</div>
<div class="paragraph">
<p>where \$"Enc"_("SC")^("Len")\$ is defined in <a href="id-cryptography-encoding.html#defn-sc-len-encoding">Definition 198</a>.</p>
</div>
<div class="paragraph">
<p>In some cases, the length indicator \$"Enc"_("SC")^("Len")(abs(S))\$ is omitted
if the length of the sequence is fixed and known by the decoder upfront. Such
cases are explicitly stated by the definition of the corresponding type.</p>
</div>
</div>
</div>
<div id="defn-scale-dictionary" class="exampleblock">
<div class="title">Definition 193. <a href="id-cryptography-encoding.html#defn-scale-dictionary">Dictionary</a></div>
<div class="content">
<div class="paragraph">
<p>SCALE codec for <strong>dictionary</strong> or <strong>hashtable</strong> D with key-value pairs \$(k_i,
v_i)\$s such that:</p>
</div>
<div class="stemblock">
<div class="content">
\$D := {(k_1, v_1), ... (k_n, v_n)}\$
</div>
</div>
<div class="paragraph">
<p>is defined the SCALE codec of \$D\$ as a sequence of key value pairs (as
tuples):</p>
</div>
<div class="stemblock">
<div class="content">
\$"Enc"_("SC")(D) := "Enc"_("SC")^("Size")(abs(D)) "||" "Enc"_("SC")(k_1, v_1) "||"..."||" "Enc"_("SC")(k_n, v_n)\$
</div>
</div>
<div class="paragraph">
<p>where \$"Enc"_("SC")^("Size")\$ is encoded the same way as
\$"Enc"_("SC")^("Len")\$ but argument \$"Size"\$ refers to the number of
key-value pairs rather than the length.</p>
</div>
</div>
</div>
<div id="defn-scale-boolean" class="exampleblock">
<div class="title">Definition 194. <a href="id-cryptography-encoding.html#defn-scale-boolean">Boolean</a></div>
<div class="content">
<div class="paragraph">
<p>The SCALE codec for a <strong>boolean value</strong> \$b\$ defined as a byte as follows:</p>
</div>
<div class="stemblock">
<div class="content">
\$"Enc"_("SC"): {"False", "True"} -&gt; bbb B_1\$
\$b -&gt; {(0, b="False"),(1, b="True"):}\$
</div>
</div>
</div>
</div>
<div id="defn-scale-string" class="exampleblock">
<div class="title">Definition 195. <a href="id-cryptography-encoding.html#defn-scale-string">String</a></div>
<div class="content">
<div class="paragraph">
<p>The SCALE codec for a <strong>string value</strong> is an encoded sequence
(<a href="id-cryptography-encoding.html#defn-scale-list">Definition 192</a>) consisting of UTF-8 encoded bytes.</p>
</div>
</div>
</div>
<div id="defn-scale-fixed-length" class="exampleblock">
<div class="title">Definition 196. <a href="id-cryptography-encoding.html#defn-scale-fixed-length">Fixed Length</a></div>
<div class="content">
<div class="paragraph">
<p>The SCALE codec, \$"Enc"_("SC")\$, for other types such as fixed length
integers not defined here otherwise, is equal to little endian encoding of those
values defined in <a href="id-cryptography-encoding.html#defn-little-endian">Definition 184</a>.</p>
</div>
</div>
</div>
<div id="defn-scale-empty" class="exampleblock">
<div class="title">Definition 197. <a href="id-cryptography-encoding.html#defn-scale-empty">Empty</a></div>
<div class="content">
<div class="paragraph">
<p>The SCALE codec, \$"Enc"_("SC")\$, for an empty type is defined to a byte
array of zero length and depicted as \$phi\$.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="sect-sc-length-and-compact-encoding"><a class="anchor" href="#sect-sc-length-and-compact-encoding"></a><a class="link" href="#sect-sc-length-and-compact-encoding">A.2.2.1. Length and Compact Encoding</a></h5>
<div class="paragraph">
<p>SCALE Length encoding is used to encode integer numbers of variying sizes prominently in an encoding length of arrays:</p>
</div>
<div id="defn-sc-len-encoding" class="exampleblock">
<div class="title">Definition 198. <a href="id-cryptography-encoding.html#defn-sc-len-encoding">Length Encoding</a></div>
<div class="content">
<div class="paragraph">
<p><strong>SCALE Length encoding</strong>, \$"Enc"_("SC")^("Len")\$, also known as a <em>compact encoding</em>, of a non-negative number \$n\$ is defined as follows:</p>
</div>
<div class="stemblock">
<div class="content">
\$"Enc"_("SC")^("Len"): bbb N -&gt; bbb B\$
\$n -&gt; b := {(l_1, 0 &lt;= n &lt; 2^6),(i_1 i_2, 2^6 &lt;= n &lt; 2^14),(j_1 j_2 j_3, 2^14 &lt;= n &lt; 2^30),(k_1 k_2 ... k_m, 2^30&lt;=n):}\$
</div>
</div>
<div class="paragraph">
<p>in where the least significant bits of the first byte of byte array b
are defined as follows:</p>
</div>
<div class="stemblock">
<div class="content">
\$l_1^1 l_1^0 = 00\$
\$i_1^1 i_1^0 = 01\$
\$j_1^1 j_1^0 = 10\$
\$k_1^1 k_1^0 = 11\$
</div>
</div>
<div class="paragraph">
<p>and the rest of the bits of \$b\$ store the value of \$n\$ in
little-endian format in base-2 as follows:</p>
</div>
<div class="stemblock">
<div class="content">
\$n := {
	(l_1^7 ... l_1^3 l_1^2, n &lt; 2^6),
	(i_2^7 ... i_2^0 i_1^7 .. i_1^2, 2^6 &lt;= n &lt; 2^14),
	(j_4^7 ... j_4^0 j_3^7 ... j_1^7 ... j_1^2, 2^14 &lt;= n &lt; 2^30),
	(k_2 + k_3 2^8 + k_4 2^(2 xx 8)+...+k_m2^((m-2)8),2^30 &lt;= n)
	:}\$
</div>
</div>
<div class="paragraph">
<p>such that:</p>
</div>
<div class="stemblock">
<div class="content">
\$k_1^7 ... k_1^3 k_1^2 := m-4\$
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="id-hex-encoding"><a class="anchor" href="#id-hex-encoding"></a><a class="link" href="#id-hex-encoding">A.2.3. Hex Encoding</a></h4>
<div class="paragraph">
<p>Practically, it is more convenient and efficient to store and process data which
is stored in a byte array. On the other hand, the trie keys are broken into
4-bits nibbles. Accordingly, we need a method to encode sequences of 4-bits
nibbles into byte arrays canonically. To this aim, we define
hex encoding function \$"Enc" ("HE")("PK")\$ as follows:</p>
</div>
<div id="defn-hex-encoding" class="exampleblock">
<div class="title">Definition 199. <a href="id-cryptography-encoding.html#defn-hex-encoding">Hex Encoding</a></div>
<div class="content">
<div class="paragraph">
<p>Suppose that \$"PK" = (k_1, ... k_n)\$ is a sequence of nibbles, then:</p>
</div>
<div class="stemblock">
<div class="content">
\$"Enc"_("HE")("PK") := {("Nibbles"_4,-&gt;, bbb B),("PK" = (k_1, ... k_n),-&gt;,{((16k_1+k_2,...,16k_(2i-1)+k_(2i)),n=2i),((k_1,16k_2+k_3,...,16k_(2i)+k_(2i+1)),n = 2i+1):}):}\$
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="chapter-genesis"><a class="anchor" href="#chapter-genesis"></a><a class="link" href="#chapter-genesis">A.3. Genesis State</a></h3>
<div class="paragraph">
<p>The genesis state is a set of key-value pairs representing the initial state of
the Polkadot state storage. It can be retrieved from
<a href="https://github.com/paritytech/polkadot/tree/master/node/service/chain-specs">the Polkadot
repository</a>. While each of those key-value pairs offers important identifiable
information to the Runtime, to the Polkadot Host they are a transparent set of
arbitrary chain- and network-dependent keys and values. The only exception to
this are the <code>:code</code> (<a href="chap-state.html#sect-loading-runtime-code">Section 2.6.2</a>) and <code>:heappages</code>
(<a href="chap-state.html#sect-memory-management">Section 2.6.3.1</a>) keys, which are used by the Polkadot Host to
initialize the WASM environment and its Runtime. The other keys and values are
unspecified and solely depend on the chain and respectively its corresponding
Runtime. On initialization the data should be inserted into the state storage
with the Host API (<a href="chap-host-api.html#sect-storage-set">Section B.2.1</a>).</p>
</div>
<div class="paragraph">
<p>As such, Polkadot does not define a formal genesis block. Nonetheless for the
compatibility reasons in several algorithms, the Polkadot Host defines the
<em>genesis header</em> (<a href="id-cryptography-encoding.html#defn-genesis-header">Definition 200</a>). By the abuse of terminology,
"genesis block" refers to the hypothetical parent of block number <em>1</em> which
holds genesis header as its header.</p>
</div>
<div id="defn-genesis-header" class="exampleblock">
<div class="title">Definition 200. <a href="id-cryptography-encoding.html#defn-genesis-header">Genesis Header</a></div>
<div class="content">
<div class="paragraph">
<p>The Polkadot genesis header is a data structure conforming to block header
format (<a href="chap-state.html#defn-block-header">Definition 10</a>). It contains the following values:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Block header field</th>
<th class="tableblock halign-left valign-top">Genesis Header Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>parent_hash</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>0</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>number</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>0</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>state_root</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Merkle hash of the state storage trie (<a href="chap-state.html#defn-merkle-value">Definition 29</a>) after inserting the genesis state in it.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>extrinsics_root</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>0</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>digest</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>0</em></p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="chapter-erasure-encoding"><a class="anchor" href="#chapter-erasure-encoding"></a><a class="link" href="#chapter-erasure-encoding">A.4. Erasure Encoding</a></h3>
<div class="sect3">
<h4 id="sect-erasure-encoding"><a class="anchor" href="#sect-erasure-encoding"></a><a class="link" href="#sect-erasure-encoding">A.4.1. Erasure Encoding</a></h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Erasure Encoding has not been documented yet.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph nav-footer">
<p>← Previous: <a href="sect-metadata.html">Metadata</a> | ↑ Up: <a href="polkadot-spec.html">Polkadot Protocol Specification</a> | Next: <a href="chap-host-api.html">Appendix B: Host API</a> →</p>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 0.2.1<br>
Last updated 2023-03-09 11:37:31 +0100
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>